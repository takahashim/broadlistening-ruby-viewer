<div id="broadlistening-view-i18n" hidden data-messages='<%= i18n_json %>'></div>

<script id="<%= data_id %>" type="application/json"><%= report_json %></script>
<div data-broadlistening-view-manager data-data-source="<%= data_id %>" id="<%= container_id %>"></div>
<p class="text-center text-gray-500 text-sm mt-2">
  <%= i18n_hash.dig("template", "chart_help") %>
</p>

<% if clusters.any? -%>
  <section class="mt-8" id="cluster-overview-section">
    <h3 class="mb-4"><%= i18n_hash.dig("template", "cluster_overview") %></h3>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4" id="cluster-grid">
      <% clusters.each_with_index do |cluster, index| -%>
        <div class="card p-4 hover:shadow-md transition-shadow cursor-pointer"
             style="border-left: 4px solid <%= cluster_color.call(index) %>;"
             data-cluster-id="<%= cluster["id"] %>">
          <div class="flex items-center gap-3 mb-2">
            <span class="inline-block w-3 h-3 rounded-full flex-shrink-0" style="background-color: <%= cluster_color.call(index) %>;"></span>
            <span class="font-semibold text-sm line-clamp-2"><%= cluster["label"] %></span>
          </div>
          <div class="flex items-center gap-2 mb-2">
            <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium" style="background-color: <%= cluster_color.call(index) %>20; color: <%= cluster_color.call(index) %>;">
              <%= (i18n_hash.dig("template", "cluster_count") || "%{count}件の意見").gsub("%{count}", (cluster["value"] || 0).to_s) %>
            </span>
          </div>
          <% if cluster["takeaway"] && !cluster["takeaway"].empty? -%>
            <p class="text-gray-2 text-sm line-clamp-3"><%= cluster["takeaway"] %></p>
          <% end -%>
        </div>
      <% end -%>
    </div>
  </section>
<% end -%>
